<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Order Details - Admin</title>

    <!-- GLOBAL -->
    <link rel="stylesheet" th:href="@{/admin/navbar.css}">

    <!-- PAGE-SPECIFIC -->
    <link rel="stylesheet" th:href="@{/admin/categorylist.css}">
    <link rel="stylesheet" th:href="@{/admin/orderdetails.css}">


</head>

<body>
<!-- Notifications -->
<div th:if="${success}" class="notification notification-success" th:text="${success}"></div>
<div th:if="${error}" class="notification notification-error" th:text="${error}"></div>

<header class="site-header">
    <div class="brand-container">
        <div class="brand">
            <span class="brand-icon">☕</span>
            <span class="brand-name">Mocha Dreams - Admin Dashboard</span>
            <span class="brand-tagline">Premium Coffee Experience</span>
        </div>
    </div>
</header>

<nav class="main-nav">
    <div class="nav-container">
        <div class="nav-links-left">
            <a th:href="@{/admin/dashboard}" class="nav-link">Dashboard</a>
            <a th:href="@{/admin/categories/}" class="nav-link">Categories</a>
            <a th:href="@{/admin/products/}" class="nav-link">Products</a>
            <a th:href="@{/orders/}" class="nav-link active">Orders</a>
            <a th:href="@{/admin/users/}" class="nav-link">Users</a>
        </div>

        <div class="nav-links-right">
            <form th:action="@{/auth/logout}" method="post">
                <button class="logout-btn">Logout</button>
            </form>
        </div>
    </div>
</nav>

<div class="container">

    <div class="details-container">

        <!-- Order Header -->
        <div class="order-header-card">
            <h1 th:text="'Order #' + ${order.id}">Order #1</h1>

            <div class="order-info-grid">
                <div class="info-label">Order Date:</div>
                <div class="info-value" th:text="${#temporals.format(order.orderDate, 'dd MMM yyyy HH:mm')}">01 Jan 2025 12:00</div>

                <div class="info-label">Customer Name:</div>
                <div class="info-value" th:text="${order.username}">Customer Name</div>

                <div class="info-label">Email:</div>
                <div class="info-value" th:text="${order.userEmail}">email@example.com</div>

                <div class="info-label">User ID:</div>
                <div class="info-value" th:text="${order.userId}">123</div>

                <div class="info-label">Status:</div>
                <div>
                    <span class="status-badge"
                          th:classappend="${'status-' + order.status}"
                          th:text="${order.status}">NEW</span>
                </div>

                <div class="info-label">Total Amount:</div>
                <div class="total-amount" th:text="'$' + ${order.total}">$0.00</div>
            </div>
        </div>

        <!-- Status Update -->
        <div class="status-update-card">
            <h3>Update Order Status</h3>

            <div class="status-form">
                <select id="status-select" class="status-select" required>
                    <option value="">-- Select New Status --</option>
                    <option value="NEW" th:selected="${order.status.name() == 'NEW'}">NEW</option>
                    <option value="PROCESSING" th:selected="${order.status.name() == 'PROCESSING'}">PROCESSING</option>
                    <option value="SHIPPED" th:selected="${order.status.name() == 'SHIPPED'}">SHIPPED</option>
                    <option value="DELIVERED" th:selected="${order.status.name() == 'DELIVERED'}">DELIVERED</option>
                    <option value="CANCELLED" th:selected="${order.status.name() == 'CANCELLED'}">CANCELLED</option>
                </select>

                <button class="btn-update-status" onclick="updateStatus()">Update Status</button>
            </div>
        </div>

        <!-- Order Items -->
        <div class="order-items-card">
            <h3>Order Items</h3>

            <div class="item-row" th:each="item : ${order.items}">
                <img th:src="${item.productImageUrl}"
                     class="item-image"
                     alt="Product Image">

                <div class="item-info">
                    <div class="item-name" th:text="${item.productName}">Product Name</div>
                    <div class="item-details">
                        Quantity: <strong th:text="${item.quantity}">1</strong> ×
                        $<span th:text="${item.unitPrice}">0.00</span>
                    </div>
                </div>

                <div class="item-price" th:text="'$' + ${item.unitPrice * item.quantity}">$0.00</div>
            </div>

            <div class="order-total-section">
                <span class="total-label">TOTAL:</span>
                <span class="total-value" th:text="'$' + ${order.total}">$0.00</span>
            </div>
        </div>

    </div>

    <a class="btn-back" onclick="history.back();">Back to Orders</a>

</div>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', function() {
        const notifications = document.querySelectorAll('.notification');
        notifications.forEach(notification => {
            setTimeout(() => notification.classList.add('show'), 10);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        });
    });

    function updateStatus() {
        const status = document.getElementById('status-select').value;

        if (!status) {
            showNotification('Please select a status', 'error');
            return;
        }

        fetch('/admin/orders/' + [[${order.id}]] + '/update-status', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: 'status=' + status
        })
            .then(r => {
                if (r.ok) {
                    // Обновляем UI без перезагрузки
                    const badge = document.querySelector('.status-badge');
                    badge.textContent = status;
                    badge.className = 'status-badge status-' + status;
                    showNotification('Status updated successfully!', 'success');
                } else {
                    showNotification('Error updating status', 'error');
                }
            })
            .catch(() => {
                showNotification('Error updating status', 'error');
            });
    }

    function showNotification(message, type) {
        const notification = document.createElement('div');
        notification.className = `notification notification-${type}`;
        notification.textContent = message;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.classList.add('show');
        }, 10);

        setTimeout(() => {
            notification.classList.remove('show');
            setTimeout(() => {
                notification.remove();
            }, 300);
        }, 3000);
    }
</script>

</body>
</html>