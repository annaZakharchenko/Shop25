<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title th:text="${product.name} + ' - Mocha Dreams'">Product Details - Mocha Dreams</title>
    <link rel="stylesheet" th:href="@{/main.css}">
    <link rel="stylesheet" th:href="@{/product.css}">

</head>
<body>

<!-- Header with Brand -->
<header class="site-header">
    <div class="brand-container">
        <div class="brand">
            <span class="brand-icon">☕</span>
            <span class="brand-name">Mocha Dreams</span>
            <span class="brand-tagline">Premium Coffee Experience</span>
        </div>
    </div>
</header>

<!-- Navigation Bar -->
<nav class="main-nav">
    <div class="nav-container">
        <!-- Guest Navigation -->
        <div sec:authorize="!isAuthenticated()" class="nav-links">
            <a th:href="@{/auth/login}" class="nav-link">
                Login
            </a>
            <a th:href="@{/auth/register}" class="nav-link">
                Register
            </a>
        </div>

        <!-- Authenticated User Navigation -->
        <div sec:authorize="isAuthenticated()" class="nav-links">
            <a th:href="@{/}" class="nav-link">
                 Home
            </a>
            <a th:href="@{/cart/}" class="nav-link">
                 Cart
                <span class="cart-badge" th:if="${cartItemCount > 0}" th:text="${cartItemCount}">0</span>
            </a>
            <a th:href="@{/users/profile/}" class="nav-link">
                 Profile
            </a>
            <a sec:authorize="hasRole('ADMIN')" th:href="@{/admin/dashboard}" class="nav-link admin-link">
                 Dashboard
            </a>
        </div>

        <!-- Logout Button -->
        <div sec:authorize="isAuthenticated()" class="nav-logout">
            <form th:action="@{/auth/logout}" method="post" class="logout-form">
                <button type="submit" class="logout-btn">
                     Logout
                </button>
            </form>
        </div>
    </div>
</nav>

<!-- Main Content -->
<main class="main-content">
    <div class="container">

        <!-- Breadcrumb -->
        <div class="breadcrumb">
            <a th:href="@{/}">Home</a>
            <span class="separator">›</span>
            <span th:text="${product.name}">Product</span>
        </div>

        <!-- Product Detail Section -->
        <section class="product-detail-section">
            <div class="product-detail-card">

                <!-- Product Image -->
                <div class="product-detail-image">
                    <img th:if="${product.imageUrl != null}"
                         th:src="${product.imageUrl}"
                         th:alt="${product.name}">
                    <img th:unless="${product.imageUrl != null}"
                         src="https://via.placeholder.com/500x500?text=No+Image"
                         alt="No image">
                    <div class="detail-badge" th:if="${product.stock < 10 && product.stock > 0}">
                        ⚠️ Limited Stock
                    </div>
                    <div class="detail-badge sold-out" th:if="${product.stock == 0}">
                        ❌ Sold Out
                    </div>
                </div>

                <!-- Product Info -->
                <div class="product-detail-info">
                    <h1 class="detail-title" th:text="${product.name}">Product Name</h1>

                    <div class="detail-price-section">
                        <div class="detail-price" th:text="'$' + ${product.price}">$0.00</div>
                        <div class="detail-stock" th:text="'In Stock: ' + ${product.stock} + ' units'">
                            In Stock: 0 units
                        </div>
                    </div>

                    <div class="detail-divider"></div>

                    <div class="detail-description">
                        <h3>Description</h3>
                        <p th:text="${product.description}">Product description goes here.</p>
                    </div>

                    <!-- Add to Cart Form for Authenticated Users -->
                    <form sec:authorize="isAuthenticated()"
                          th:action="@{/cart/add/{id}(id=${product.id})}"
                          method="post"
                          class="detail-form">

                        <div class="quantity-selector">
                            <label for="quantity">Quantity:</label>
                            <div class="quantity-controls">
                                <button type="button" class="qty-btn" onclick="decreaseQty()">−</button>
                                <input type="number"
                                       id="quantity"
                                       name="quantity"
                                       value="1"
                                       min="1"
                                       th:max="${product.stock}">
                                <button type="button" class="qty-btn" onclick="increaseQty()" th:attr="data-max=${product.stock}">+</button>
                            </div>
                        </div>

                        <div class="detail-actions">
                            <button type="submit"
                                    th:disabled="${product.stock == 0}"
                                    class="btn btn-add-cart">
                                 Add to Cart
                            </button>
                            <a class="btn btn-back" onclick="history.back();">
                                 Back to Products
                            </a>
                        </div>
                    </form>

                    <!-- Guest Message -->
                    <div sec:authorize="!isAuthenticated()" class="guest-message">
                        <p>Please <a th:href="@{/auth/login}">login</a> or <a th:href="@{/auth/register}">create an account</a> to purchase this product.</p>
                        <a class="btn btn-back" onclick="history.back();">
                            ← Back to Products
                        </a>
                    </div>
                </div>
            </div>
        </section>

    </div>
</main>

<!-- Footer -->
<footer class="site-footer">
    <div class="container">
        <p>&copy; 2025 Mocha Dreams. All rights reserved.</p>
        <p>Premium Coffee Experience, Delivered to Your Door</p>
    </div>
</footer>

<!-- JavaScript -->
<script>
    function decreaseQty() {
        const input = document.getElementById('quantity');
        const currentValue = parseInt(input.value);
        if (currentValue > 1) {
            input.value = currentValue - 1;
        }
    }

    function increaseQty() {
        const input = document.getElementById('quantity');
        const button = event.target;
        const maxValue = parseInt(button.getAttribute('data-max'));
        const currentValue = parseInt(input.value);
        if (currentValue < maxValue) {
            input.value = currentValue + 1;
        }
    }
</script>

</body>
</html>